// This file automatically generated from AdExactSolutions.bC with bpp.
// ==========================================================================================================
// Class to define exact solutions for CgAd
// 
//   (1) DOUBLE ANNULUS
// 
// ==========================================================================================================


#include "AdExactSolutions.h"

#include "NurbsMapping.h"

#include "PlotStuff.h"
#include "ParallelUtility.h"

#include <complex>


typedef ::real LocalReal;
// typedef ::real OV_real;

typedef std::vector<std::complex<Real> > ComplexVector;

#define FOR_3D(i1,i2,i3,I1,I2,I3)                                       int I1Base =I1.getBase(),   I2Base =I2.getBase(),  I3Base =I3.getBase(); int I1Bound=I1.getBound(),  I2Bound=I2.getBound(), I3Bound=I3.getBound(); for(i3=I3Base; i3<=I3Bound; i3++)                                       for(i2=I2Base; i2<=I2Bound; i2++)                                     for(i1=I1Base; i1<=I1Bound; i1++)



// ===============================================================================
/// \brief  Default constructor for the class that defines exact solutions 
/// \notes: Exact solutions are "doubleAnnulus" and "doubleRectangle"
// ===============================================================================
AdExactSolutions::
AdExactSolutions( )
{
    setup(); 
}


// // ===============================================================================
// /// \brief  Constructor for the class that defines exact solutions 
// /// \param solution (input) : name of exact solution. 
// ///    Exact solutions are "doubleAnnulus" and "doubleRectangle"
// // ===============================================================================
// AdExactSolutions::
// AdExactSolutions( const aString & solution )
// {
//   setup( solution );
// }

// ===============================================================================
/// \brief Setup routine.
// ===============================================================================
int AdExactSolutions::setup()
{
    dbase.put<aString>("exactSolution")="unknown";

  // dbase.put<int>("numberOfDimensions");
    dbase.put<bool>("initialized")=false;
    dbase.put<int>("domain")=-1; 

    dbase.put<Real>("sr") = -1.; // Re(s)
    dbase.put<Real>("si") = -1.; // Im(s)

}


// ===============================================================================
/// \brief destructor 
// ===============================================================================
AdExactSolutions::
~AdExactSolutions()
{
  // if( dbase.has_key("nurbs") )
  // {
  //   NurbsMapping *nurbs = dbase.get<NurbsMapping*>("nurbs");
  //   delete [] nurbs;
  // }
    

}


// // ===============================================================================
// /// \brief Set the domain number for multidomain solutions such as
// ///   the double annulus
// // ===============================================================================
// int AdExactSolutions::setDomain( int domain )
// {
//   dbase.get<int>("domain") = domain;
//   return 0;
// }


// ===============================================================================
/// \brief Return a solution parameter by name
// ===============================================================================
int AdExactSolutions::
getParameter( const aString & name, Real & value )
{
    if( dbase.has_key(name) )
    {
        value = dbase.get<Real>(name);
    }
    else
    {
        printF("AdExactSolutions::getParameter: ERROR: unknown parameter=[%s]\n",(const char*)name);
    }
    return 0;
}

// // ----------------------------------------------------------------
// // FindEvaluate the polar cooridinates from the cartesian coordinates 
// // ----------------------------------------------------------------
// #beginMacro getRadiusPolar(i1,i2,i3,r)
//   Real x = xLocal(i1,i2,i3,0);
//   Real y = xLocal(i1,i2,i3,1);
//   Real r = sqrt( x*x + y*y );

//   if( r < eps ) //  avoid division by zero
//   {
//     x=eps;           // avoid atan(0,0)
//     y=eps;
//     r=sqrt(2.)*eps;  // r=sqrt(x**2+y**2)
//   }   
// #endMacro



// =======================================================================
// Macro : Process the exact solution data and create Nurbs to evalue it.
// =======================================================================


// ===============================================================================
/// \brief Initialize the exact solution.
/// \param solution (input) : name of the case solution, 
//       "doubleAnnulus" or "doubleRectangle".
/// \param caseName (input) : 
// ===============================================================================
int AdExactSolutions::
initialize( CompositeGrid & cg, const aString & solution, const aString & caseName )
{

    aString & exactSolution = dbase.get<aString>("exactSolution");
    exactSolution=solution;

    bool & initialized=dbase.get<bool>("initialized");
    initialized=true;

    int & domain = dbase.get<int>("domain"); 
  // assert( domain>=0 );

  // --- First find out which domain this is ---
    int grid=0;
    MappedGrid & mg = cg[grid];
    const IntegerArray & gid = mg.gridIndexRange();
    mg.update(MappedGrid::THEvertex | MappedGrid::THEcenter);
    OV_GET_SERIAL_ARRAY(real,mg.center(),xLocal);

    int i1 = int( (gid(0,0)+gid(1,0))/2 );
    int i2 = int( (gid(0,1)+gid(1,1))/2 );
    int i3 = int( (gid(0,2)+gid(1,2))/2 );

  // -- Variables assigned in the include file: 
    Real & sr = dbase.get<Real>("sr");   // eigenvalue is saved here in data-base
    Real & si = dbase.get<Real>("si");   // eigenvalue is saved here in data-base
    
    Real ra,rb,rc;
    int nth;

  // --- We fit the numerical exact solution to a spline ---

    const int numNurbs = 1; // we just need 1 Nurbs to hold both Re and Im parts
    NurbsMapping *nurbs = new NurbsMapping [numNurbs];

    if( exactSolution=="doubleAnnulus" )
    {
    // Here is a radius near the center of the grid 
        Real rCenter = sqrt( SQR(xLocal(i1,i2,i3,0)) + SQR(xLocal(i1,i2,i3,1)) ); 

    // Real ra_=0.5, rb_=1., rc_=1.5, sr_=-1., si_=-1.; 
    // int nth_=1;
    // int numGhost_; 

    // --- the next include file defines the exact solution, computed approximately ---
    //   uLvRe[] = array of real part of uL 
    //   uLvIm[] = array of imag part of uL 
    //   uRvRe[] = array of real part of uR 
    //   uRvIm[] = array of imag part of uR 

        if( 1==0 && caseName == "doubleAnnulusDD" )
        {
      // Displacement displacement:
      // >> from $ism/matlab/cylinderDiscreteEigFuncs/hollowCylinderEigFun_d_d.h
      // #Include "src/incompressible/hollowCylinderEigFun_d_d.h"
      // getExactSolutionMacro();
        }
        if( caseName == "doubleAnnulusCase4" )
        {
      // --- Advection diffusion case ---

      // file created by AMP/champ4/codes/doubleAnnulus.maple
// ---------------------------------------------------------------------------------------------------------
// doubleAnnulus CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
ra =   5.0000000000000000e-01, rb=  1.0000000000000000e+00, rc=  1.5000000000000000e+00; // radii
sr= -3.3382234651291290e+01, si= -4.5209869316203120e-01; // Re and Im parts of eigenvalue s
nth = 1; // solution is exp(i*nth*theta) 
Real DL=  9.0000000000000000e-01, KL=  1.0000000000000000e+00, urtL[]={  5.0000000000000000e-01,  3.0000000000000000e-01}; // urtL = radial and theta velocities
Real DR=  8.0000000000000000e-01, KR=  5.0000000000000000e-01, urtR[]={  4.0000000000000000e-01,  6.0000000000000000e-01}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dr=  6.2500000000000000e-03;  // dr

Real uLvRe[]={
  -1.02699624439775e+00, -9.63676516548644e-01, -8.99945586421684e-01, -8.35863934306659e-01, -7.71493212430272e-01,
  -7.06896116940855e-01, -6.42136262834334e-01, -5.77278061547887e-01, -5.12386600987067e-01, -4.47527527794341e-01,
  -3.82766931755655e-01, -3.18171232185217e-01, -2.53807066229429e-01, -1.89741178954041e-01, -1.26040315206603e-01,
  -6.27711132278088e-02,  0.00000000000000e+00,  6.22069117636029e-02,  1.23783924866412e-01,  1.84665857155673e-01,
    2.44788139345888e-01,  3.04086911001271e-01,  3.62499114721892e-01,  4.19962588475559e-01,  4.76416156032903e-01,
    5.31799715406907e-01,  5.86054325282137e-01,  6.39122289367475e-01,  6.90947238610222e-01,  7.41474211225543e-01,
    7.90649730429999e-01,  8.38421879852092e-01,  8.84740376544118e-01,  9.29556641565452e-01,  9.72823868008119e-01,
    1.01449708643298e+00,  1.05453322766755e+00,  1.09289118291196e+00,  1.12953186103446e+00,  1.16441824305411e+00,
    1.19751543376419e+00,  1.22879071038168e+00,  1.25821356822371e+00,  1.28575576336417e+00,  1.31139135217763e+00,
    1.33509672778790e+00,  1.35685065333731e+00,  1.37663429206317e+00,  1.39443123414266e+00,  1.41022752027682e+00,
    1.42401166198619e+00,  1.43577465860465e+00,  1.44551001093766e+00,  1.45321373159066e+00,  1.45888435193885e+00,
    1.46252292574102e+00,  1.46413302939766e+00,  1.46372075884616e+00,  1.46129472310453e+00,  1.45686603447357e+00,
    1.45044829540793e+00,  1.44205758207427e+00,  1.43171242462900e+00,  1.41943378422119e+00,  1.40524502676395e+00,
    1.38917189352808e+00,  1.37124246853131e+00,  1.35148714287353e+00,  1.32993857592653e+00,  1.30663165357630e+00,
    1.28160344344812e+00,  1.25489314722641e+00,  1.22654205018898e+00,  1.19659346786482e+00,  1.16509269004349e+00,
    1.13208692216899e+00,  1.09762522410403e+00,  1.06175844643984e+00,  1.02453916443030e+00,  9.86021609613581e-01,
    9.46261599180349e-01,  9.05316463217429e-01,  8.63244969930135e-01,  8.20107248931723e-01,  7.75964712688704e-01,
    7.30879976253052e-01,  6.84916775323957e-01,  6.38139882808964e-01,  5.90615023991440e-01,  5.42408790401108e-01,
    4.93588552508845e-01,  4.44222371291028e-01,  3.94378908895794e-01,  3.44127338490221e-01,  2.93537253389700e-01,
    2.42678575518949e-01,  1.91621463481435e-01,  1.40436220300146e-01,  8.91932008446470e-02,  3.79627191872833e-02,
  -1.31850439465174e-02, -6.41801336882032e-02, -1.14952913239652e-01, -1.65434155614331e-01, -2.15555134991404e-01,
  -2.65247717367092e-01, -3.14444450402532e-01, -3.63078652489169e-01, -4.11084500778258e-01, -4.58397118053195e-01,
  -5.04952658390194e-01, -5.50688391524084e-01, -5.95542785688253e-01
};
Real uLvIm[]={
  -4.20802706807306e-04, -3.38342144752135e-04, -2.68360961157327e-04, -2.09556972141860e-04, -1.60705699349234e-04,
  -1.20657536908478e-04, -8.83351022994622e-05, -6.27307451963358e-05, -4.29041918372818e-05, -2.79803057586382e-05,
  -1.71469456375832e-05, -9.65290655804812e-06, -4.80593223905157e-06, -1.97078594538860e-06, -5.67369472255154e-07,
  -6.88798739122999e-08,  0.00000000000000e+00,  6.48853234039261e-08,  5.03454681072384e-07,  1.64720024927802e-06,
    3.78316584132185e-06,  7.15567751062914e-06,  1.19680702166241e-05,  1.83844101134550e-05,  2.65312154594209e-05,
    3.64991771975026e-05,  4.83448799061252e-05,  6.20925239351995e-05,  7.77356472831100e-05,  9.52388480600693e-05,
    1.14539506347486e-04,  1.35549505377122e-04,  1.58156950581537e-04,  1.82227884719836e-04,  2.07607997897125e-04,
    2.34124331670732e-04,  2.61586974980926e-04,  2.89790749531528e-04,  3.18516883043321e-04,  3.47534669403513e-04,
    3.76603111942713e-04,  4.05472548155973e-04,  4.33886254921111e-04,  4.61582030161697e-04,  4.88293749543440e-04,
    5.13752896616116e-04,  5.37690062330180e-04,  5.59836413784376e-04,  5.79925128097745e-04,  5.97692790553957e-04,
    6.12880753867306e-04,  6.25236457166794e-04,  6.34514701894306e-04,  6.40478883353714e-04,  6.42902175099393e-04,
    6.41568665004467e-04,  6.36274440701590e-04,  6.26828622797608e-04,  6.13054344223283e-04,  5.94789674123338e-04,
    5.71888484775048e-04,  5.44221260216020e-04,  5.11675845322558e-04,  4.74158133989352e-04,  4.31592695709002e-04,
    3.83923339297560e-04,  3.31113613008699e-04,  2.73147240607329e-04,  2.10028492322708e-04,  1.41782490748084e-04,
    6.84554511113169e-05, -9.88514460976220e-06, -9.31504387565744e-05, -1.81230155642864e-04, -2.73992624559808e-04,
  -3.71284867725726e-04, -4.72932753720204e-04, -5.78741215090310e-04, -6.88494529365074e-04, -8.01956662795232e-04,
  -9.18871676248087e-04, -1.03896419181210e-03, -1.16193991886860e-03, -1.28748623836029e-03, -1.41527284393265e-03,
  -1.54495243815460e-03, -1.67616148273991e-03, -1.80852100042189e-03, -1.94163742659714e-03, -2.07510350891693e-03,
  -2.20849925264903e-03, -2.34139291036773e-03, -2.47334201248418e-03, -2.60389443669467e-03, -2.73258951407726e-03,
  -2.85895917006395e-03, -2.98252909598597e-03, -3.10281994929866e-03, -3.21934858080239e-03, -3.33162928473091e-03,
  -3.43917506856581e-03, -3.54149894155980e-03, -3.63811521742750e-03, -3.72854082791921e-03, -3.81229664641167e-03,
  -3.88890881623047e-03, -3.95791008119048e-03, -4.01884111664249e-03, -4.07125185641297e-03, -4.11470281271923e-03,
  -4.14876638661714e-03, -4.17302816621759e-03, -4.18708820827347e-03
};
Real uRvRe[]={
    1.73380641008367e+00,  1.64939440465109e+00,  1.56269535278506e+00,  1.47384963733202e+00,  1.38300049904330e+00,
    1.29029382221149e+00,  1.19587791671956e+00,  1.09990329643596e+00,  1.00252245418532e+00,  9.03889634181242e-01,
    8.04160601460632e-01,  7.03492409513953e-01,  6.02043165690862e-01,  4.99971795372496e-01,  3.97437804728476e-01,
    2.94601042901818e-01,  1.91621463481435e-01,  8.86588861388646e-02, -1.41272416604215e-02, -1.16578082311048e-01,
  -2.18535644620285e-01, -3.19843019151268e-01, -4.20344611883260e-01, -5.19886375689616e-01, -6.18316039677700e-01,
  -7.15483335488046e-01, -8.11240220864694e-01, -9.05441099447596e-01, -9.97943037199263e-01, -1.08860597440819e+00,
  -1.17729293356970e+00, -1.26387022246282e+00, -1.34820763209469e+00, -1.43017862961600e+00, -1.50966054536219e+00,
  -1.58653475408529e+00, -1.66068685017082e+00, -1.73200681617656e+00, -1.80038918485912e+00, -1.86573319427325e+00,
  -1.92794293553864e+00, -1.98692749344379e+00, -2.04260107924436e+00, -2.09488315577114e+00, -2.14369855449396e+00,
  -2.18897758440164e+00, -2.23065613255706e+00, -2.26867575613810e+00, -2.30298376583014e+00, -2.33353330048014e+00,
  -2.36028339282165e+00, -2.38319902625492e+00, -2.40225118253336e+00, -2.41741688030312e+00, -2.42867920444297e+00,
  -2.43602732614663e+00, -2.43945651372046e+00, -2.43896813407836e+00, -2.43456964493014e+00, -2.42627457767442e+00,
  -2.41410251101935e+00, -2.39807903537144e+00, -2.37823570804410e+00, -2.35460999935520e+00, -2.32724522969558e+00,
  -2.29619049766000e+00, -2.26150059933463e+00, -2.22323593891823e+00, -2.18146243073492e+00, -2.13625139282690e+00,
  -2.08767943234473e+00, -2.03582832273963e+00, -1.98078487321424e+00, -1.92264079029232e+00, -1.86149253208170e+00,
  -1.79744115513649e+00, -1.73059215431569e+00, -1.66105529598511e+00, -1.58894444443434e+00, -1.51437738225170e+00,
  -1.43747562469294e+00, -1.35836422814283e+00, -1.27717159336656e+00, -1.19402926367749e+00, -1.10907171806382e+00,
  -1.02243616004825e+00, -9.34262302411415e-01, -8.44692147819089e-01, -7.53869766326957e-01, -6.61941069431914e-01,
  -5.69053581486426e-01, -4.75356208657808e-01, -3.80999005685043e-01, -2.86132941082694e-01, -1.90909660784714e-01,
  -9.54812509424088e-02,  1.69934000000000e-13,  9.53818395141873e-02,  1.90512288985315e-01,  2.85239881411546e-01,
    3.79413898110779e-01,  4.72884604310690e-01,  5.65503483194482e-01,  6.57123467892592e-01,  7.47599171381960e-01,
    8.36787113508860e-01,  9.24545945236546e-01,  1.01073666937919e+00,  1.09522285769980e+00,  1.17787086408166e+00,
    1.25855003308497e+00,  1.33713290415776e+00,  1.41349541054894e+00
};
Real uRvIm[]={
    1.98513321379581e-03,  1.57860662740935e-03,  1.18799509688586e-03,  8.12604515723685e-04,  4.51743211687790e-04,
    1.04724749981197e-04, -2.29129388299665e-04, -5.50487252102612e-04, -8.60003993018434e-04, -1.15831957341032e-03,
  -1.44605660456792e-03, -1.72381832606597e-03, -1.99218672041664e-03, -2.25172077152138e-03, -2.50295486253695e-03,
  -2.74639731947604e-03, -2.98252909598597e-03, -3.21180260492441e-03, -3.43464069229804e-03, -3.65143575531461e-03,
  -3.86254900480933e-03, -4.06830986852910e-03, -4.26901553572932e-03, -4.46493064177204e-03, -4.65628708827370e-03,
  -4.84328400062944e-03, -5.02608781528017e-03, -5.20483249939137e-03, -5.37961989435897e-03, -5.55052018439660e-03,
  -5.71757248358611e-03, -5.88078553781170e-03, -6.04013853984925e-03, -6.19558204921824e-03, -6.34703901538021e-03,
  -6.49440589904176e-03, -6.63755388424804e-03, -6.77633017910240e-03, -6.91055939836197e-03, -7.04004502119076e-03,
  -7.16457092141668e-03, -7.28390296158112e-03, -7.39779064627407e-03, -7.50596882941907e-03, -7.60815946731623e-03,
  -7.70407341419329e-03, -7.79341225107698e-03, -7.87587014461987e-03, -7.95113572720987e-03, -8.01889399396305e-03,
  -8.07882820940654e-03, -8.13062181767086e-03, -8.17396035067272e-03, -8.20853332747812e-03, -8.23403613913867e-03,
  -8.25017191302840e-03, -8.25665335078391e-03, -8.25320453406994e-03, -8.23956269254440e-03, -8.21547992857455e-03,
  -8.18072489328441e-03, -8.13508440878022e-03, -8.07836503153096e-03, -8.01039455206124e-03, -7.93102342634821e-03,
  -7.84012613433971e-03, -7.73760246161027e-03, -7.62337870006019e-03, -7.49740876356728e-03, -7.35967521577086e-03,
  -7.21019020595886e-03, -7.04899631049771e-03, -6.87616727699167e-03, -6.69180866844156e-03, -6.49605840546050e-03,
  -6.28908720465336e-03, -6.07109891077516e-03, -5.84233072293657e-03, -5.60305331152211e-03, -5.35357082692998e-03,
  -5.09422079927900e-03, -4.82537392749725e-03, -4.54743375964587e-03, -4.26083626462780e-03, -3.96604929420755e-03,
  -3.66357193849814e-03, -3.35393377563356e-03, -3.03769401527884e-03, -2.71544054123787e-03, -2.38778885180594e-03,
  -2.05538090255353e-03, -1.71888385342119e-03, -1.37898872234235e-03, -1.03640895019639e-03, -6.91878878412163e-04,
  -3.46152144770272e-04,  9.18266000000000e-16,  3.45790450563609e-04,  6.90418074971578e-04,  1.03306960970962e-03,
    1.37292161509026e-03,  1.70914248748320e-03,  2.04089452334323e-03,  2.36733602840267e-03,  2.68762346941839e-03,
    3.00091365954020e-03,  3.30636597552287e-03,  3.60314459763273e-03,  3.89042076893147e-03,  4.16737506751545e-03,
    4.43319968406366e-03,  4.68710070260370e-03,  4.92830037376652e-03
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  ra=%g, rb=%g, rc=%g, sr=%g, si=%g, nth=%d\n",ra,rb,rc,sr,si,nth);
                if( rCenter >= ra && rCenter<= rb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= rb && rCenter<= rc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=ra; rb_=rb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=ra                      r=rb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  ra=%g, rb=%g, rc=%g, sr=%g, si=%g, nth=%d\n",ra,rb,rc,sr,si,nth);

        }
        else if( caseName == "doubleAnnulusCase5" )
        {
      // --- Diffusion case to match case we can solve analytically --

      // file created by AMP/champ4/codes/doubleAnnulus.maple
// ---------------------------------------------------------------------------------------------------------
// doubleAnnulus CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
ra =   5.0000000000000000e-01, rb=  1.0000000000000000e+00, rc=  1.5000000000000000e+00; // radii
sr= -8.7153544143447410e+00, si=  0.0000000000000000e+00; // Re and Im parts of eigenvalue s
nth = 1; // solution is exp(i*nth*theta) 
Real DL=  9.0000000000000000e-01, KL=  1.0000000000000000e+00, urtL[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtL = radial and theta velocities
Real DR=  8.0000000000000000e-01, KR=  5.0000000000000000e-01, urtR[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dr=  6.2500000000000000e-03;  // dr

Real uLvRe[]={
  -1.10697532444629e+00, -1.03093464837616e+00, -9.55910203271320e-01, -8.81873012526308e-01, -8.08796685347677e-01,
  -7.36657217637881e-01, -6.65432809763740e-01, -5.95103699534310e-01, -5.25652008906994e-01, -4.57061603101996e-01,
  -3.89317960925637e-01, -3.22408055285788e-01, -2.56320242938485e-01, -1.91044162623292e-01, -1.26570640825063e-01,
  -6.28916044689646e-02,  0.00000000000000e+00,  6.21102816054030e-02,  1.23444474886276e-01,  1.84007004695819e-01,
    2.43801546708245e-01,  3.02831083898518e-01,  3.61097959198765e-01,  4.18603924765489e-01,  4.75350187888271e-01,
    5.31337454089663e-01,  5.86565967557664e-01,  6.41035549042332e-01,  6.94745631416176e-01,  7.47695292985614e-01,
    7.99883288985945e-01,  8.51308081192197e-01,  9.01967865823750e-01,  9.51860599689796e-01,  1.00098402503410e+00,
    1.04933569298550e+00,  1.09691298570960e+00,  1.14371313719397e+00,  1.18973325309292e+00,  1.23497032951297e+00,
    1.27942127076044e+00,  1.32308290605472e+00,  1.36595200555539e+00,  1.40802529555253e+00,  1.44929947276684e+00,
    1.48977121796331e+00,  1.52943720897980e+00,  1.56829413308322e+00,  1.60633869858133e+00,  1.64356764599751e+00,
    1.67997775871381e+00,  1.71556587303687e+00,  1.75032888772352e+00,  1.78426377316028e+00,  1.81736758008768e+00,
    1.84963744779901e+00,  1.88107061200496e+00,  1.91166441236449e+00,  1.94141629960950e+00,  1.97032384224681e+00,
    1.99838473303731e+00,  2.02559679515715e+00,  2.05195798795057e+00,  2.07746641244511e+00,  2.10212031663915e+00,
    2.12591810046119e+00,  2.14885832041924e+00,  2.17093969409715e+00,  2.19216110440307e+00,  2.21252160347269e+00,
    2.23202041644412e+00,  2.25065694503358e+00,  2.26843077081916e+00,  2.28534165834015e+00,  2.30138955804588e+00,
    2.31657460903449e+00,  2.33089714154685e+00,  2.34435767933506e+00,  2.35695694186511e+00,  2.36869584631377e+00,
    2.37957550938744e+00,  2.38959724900830e+00,  2.39876258584727e+00,  2.40707324467589e+00,  2.41453115556449e+00,
    2.42113845494953e+00,  2.42689748655790e+00,  2.43181080218553e+00,  2.43588116232383e+00,  2.43911153666397e+00,
    2.44150510446873e+00,  2.44306525481470e+00,  2.44379558670772e+00,  2.44369990906804e+00,  2.44278224059743e+00,
    2.44104680952890e+00,  2.43849805325798e+00,  2.43514061785678e+00,  2.43097935747649e+00,  2.42601933364610e+00,
    2.42026581445677e+00,  2.41372427363734e+00,  2.40640038952356e+00,  2.39830004392972e+00,  2.38942932094035e+00,
    2.37979450557050e+00,  2.36940208232669e+00,  2.35825873369684e+00,  2.34637133857142e+00,  2.33374697050557e+00,
    2.32039289590434e+00,  2.30631657221121e+00,  2.29152564591041e+00
};
Real uLvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
Real uRvRe[]={
    2.41340781107284e+00,  2.42214945483169e+00,  2.42991863729838e+00,  2.43671788637460e+00,  2.44255000597632e+00,
    2.44741807666214e+00,  2.45132545607959e+00,  2.45427577923303e+00,  2.45627295857655e+00,  2.45732118393521e+00,
    2.45742492225786e+00,  2.45658891720388e+00,  2.45481818856710e+00,  2.45211803154064e+00,  2.44849401582558e+00,
    2.44395198458654e+00,  2.43849805325798e+00,  2.43213860819915e+00,  2.42488030519476e+00,  2.41673006783651e+00,
    2.40769508574618e+00,  2.39778281266318e+00,  2.38700096439274e+00,  2.37535751663108e+00,  2.36286070267458e+00,
    2.34951901097111e+00,  2.33534118254444e+00,  2.32033620831004e+00,  2.30451332631184e+00,  2.28788201877028e+00,
    2.27045200900841e+00,  2.25223325834967e+00,  2.23323596287311e+00,  2.21347054996661e+00,  2.19294767487583e+00,
    2.17167821720189e+00,  2.14967327709753e+00,  2.12694417151421e+00,  2.10350243043549e+00,  2.07935979271660e+00,
    2.05452820213079e+00,  2.02901980327466e+00,  2.00284693708487e+00,  1.97602213680051e+00,  1.94855812336855e+00,
    1.92046780091608e+00,  1.89176425239167e+00,  1.86246073465972e+00,  1.83257067392557e+00,  1.80210766098696e+00,
    1.77108544616552e+00,  1.73951793461108e+00,  1.70741918120851e+00,  1.67480338542176e+00,  1.64168488640070e+00,
    1.60807815764379e+00,  1.57399780176205e+00,  1.53945854536705e+00,  1.50447523356864e+00,  1.46906282464424e+00,
    1.43323638473379e+00,  1.39701108221508e+00,  1.36040218227094e+00,  1.32342504143054e+00,  1.28609510185021e+00,
    1.24842788577656e+00,  1.21043898997704e+00,  1.17214407994715e+00,  1.13355888427383e+00,  1.09469918899439e+00,
    1.05558083175135e+00,  1.01621969606444e+00,  9.76631705650782e-01,  9.36832818549878e-01,  8.96839021322635e-01,
    8.56666323345951e-01,  8.16330750944534e-01,  7.75848341545149e-01,  7.35235137931817e-01,  6.94507182429065e-01,
    6.53680511057692e-01,  6.12771147732066e-01,  5.71795098517640e-01,  5.30768345820234e-01,  4.89706842601508e-01,
    4.48626506626398e-01,  4.07543214758330e-01,  3.66472797222758e-01,  3.25431031905522e-01,  2.84433638677564e-01,
    2.43496273768099e-01,  2.02634524148202e-01,  1.61863901939298e-01,  1.21199838860752e-01,  8.06576807108647e-02,
    4.02526818968214e-02, -1.67980000000000e-15, -4.00853096254086e-02, -7.99882992084369e-02, -1.19694133874220e-01,
  -1.59188096889618e-01, -1.98455594869050e-01, -2.37482162936559e-01, -2.76253469834673e-01, -3.14755322973763e-01,
  -3.52973673398652e-01, -3.90894620725781e-01, -4.28504418015146e-01, -4.65789476583332e-01, -5.02736370720691e-01,
  -5.39331842359649e-01, -5.75562805685191e-01, -6.11416351677772e-01
};
Real uRvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  ra=%g, rb=%g, rc=%g, sr=%g, si=%g, nth=%d\n",ra,rb,rc,sr,si,nth);
                if( rCenter >= ra && rCenter<= rb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= rb && rCenter<= rc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=ra; rb_=rb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=ra                      r=rb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  ra=%g, rb=%g, rc=%g, sr=%g, si=%g, nth=%d\n",ra,rb,rc,sr,si,nth);
        }  
        else
        {
            printF("AdExactSolutions::initialize: unknown caseName=[%s]\n",(const char*)caseName);
            OV_ABORT("error");

        }
        if( true )
            printF("============= %s : caseName = %s, domain=%d =============\n",
                (const char*)exactSolution,(const char*)caseName,domain);

        if( 0==1 )
        {
      // Plot radial solution for testing 
            GenericGraphicsInterface & gi = *Overture::getGraphicsInterface();
            PlotStuffParameters psp;
            psp.set(GI_PLOT_THE_OBJECT_AND_EXIT,false);
      // plot the curve (x(r),y(r),z(r))
            for( int n = 0 ; n<numNurbs; n++ )
            {
                psp.set(GI_TOP_LABEL,sPrintF("Nurbs[%d]",n));
                PlotIt::plot( gi,nurbs[n], psp );
            }

            OV_ABORT("stop here for now");
        }


    // ---- Fill in Grid functions with the Real and Imaginary Parts of the Spatial Eigenfunction ----

        realCompositeGridFunction & wRe = dbase.put<realCompositeGridFunction>("wRe");
        realCompositeGridFunction & wIm = dbase.put<realCompositeGridFunction>("wIm");

        const int numberOfDimensions = cg.numberOfDimensions();

        const int numberOfComponents = 1; // 
        Range all;
        wRe.updateToMatchGrid(cg,all,all,all,numberOfComponents);
        wIm.updateToMatchGrid(cg,all,all,all,numberOfComponents);

        RealArray rv(1,1), wv(1,3);
        rv=0.;

        std::complex<LocalReal> I(0,1.); 
        std::complex<LocalReal> u, expi; 

    // exp( - I*omega*t )
    // std::complex<LocalReal> expiOmegat = cos(omega*t) - I*sin(omega*t);

        Real a,b;  // local values for inner and outer radii
        if( domain==0 )
        {
            a=ra; b=rb;  // inner annulus
        }
        else
        {
            a=rb; b=rc; // outer annulus
        }

        printF("Eval the solution: ra=%g, rb=%g, rc=%g\n",ra,rb,rc);
        const Real eps=1.e-9;   // ********************************** FIX ME *********
        Index I1,I2,I3;
        for( int grid=0; grid<cg.numberOfComponentGrids(); grid++ )
        {
            MappedGrid & mg = cg[grid];
            mg.update(MappedGrid::THEvertex | MappedGrid::THEcenter);
            getIndex( mg.dimension(),I1,I2,I3 );

            OV_GET_SERIAL_ARRAY(real,mg.center(),xLocal);
            OV_GET_SERIAL_ARRAY(real,wRe[grid],wReLocal);
            OV_GET_SERIAL_ARRAY(real,wIm[grid],wImLocal);

            int i1,i2,i3;
            FOR_3D(i1,i2,i3,I1,I2,I3)
            {

                Real x = xLocal(i1,i2,i3,0);
                Real y = xLocal(i1,i2,i3,1);
                Real r = sqrt( x*x + y*y );
                if( r < eps ) //  avoid division by zero
                {
                    x=eps;           // avoid atan(0,0)
                    y=eps;
                    r=sqrt(2.)*eps;  // r=sqrt(x**2+y**2)
                } 
                const Real theta = atan2(y,x);

                rv(0,0) = (r-a)/(b-a); // scale r to [0,1]

                nurbs[0].map( rv,wv );  // eval Real and Im parts of u
                u = ( wv(0,0) + I*wv(0,1) ) ;

        // --- form the spatial part (complex) of the solution ---
        // expi = exp(i*m*theta) * exp(i*kz*z ) = exp( i*( m*theta + kz*z ) )
                expi = cos(nth*theta) + I*sin( nth*theta );

                u = u*expi;  // complex solution (without time dependence ß)

                wReLocal(i1,i2,i3,0) = std::real( u );
                wImLocal(i1,i2,i3,0) = std::imag( u );


            }

        } // end for grid 


        if( 0==1 )
        {
      // Plot wRe and wIm

            GenericGraphicsInterface & gi = *Overture::getGraphicsInterface();
            PlotStuffParameters psp;
            psp.set(GI_PLOT_THE_OBJECT_AND_EXIT,false);
            psp.set(GI_TOP_LABEL,sPrintF("wRe domain=%d",domain));
            gi.erase();
            PlotIt::contour( gi,wRe, psp );
            gi.erase();
            psp.set(GI_TOP_LABEL,sPrintF("wIm domain=%d",domain));
            PlotIt::contour( gi,wIm, psp );
            gi.erase();
      // OV_ABORT("stop here for now");
        }

    // clean up 
        delete [] nurbs;
        
    }

    else if( exactSolution=="doubleRectangle" )
    {
        if( true )
            printF("============= %s : caseName = %s, domain=%d =============\n",
                (const char*)exactSolution,(const char*)caseName,domain);
  
        Real rCenter = xLocal(i1,i2,i3,0);   // point at center of the domain

    // --- solution parameters ---
        Real & sr = dbase.get<Real>("sr");   
        Real & si = dbase.get<Real>("si"); 

        Real & ky = dbase.put<Real>("ky"); 
    // std::complex<LocalReal> & aPlus  = dbase.put<complex<LocalReal> >("aPlus");  
    // std::complex<LocalReal> & aMinus = dbase.put<complex<LocalReal> >("aMinus");  

    // std::complex<LocalReal> & rPlus  = dbase.put<complex<LocalReal> >("rPlus");  
    // std::complex<LocalReal> & rMinus = dbase.put<complex<LocalReal> >("rMinus");  

    // --- variables assigned in the following include files ---

        Real xa,xb,xc;
        if( caseName == "doubleRectangleDL1KL1DR1KR1" )
        {

// ---------------------------------------------------------------------------------------------------------
// doubleRectangle CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
xa =  -1.0000000000000000e+00, xb =   0.0000000000000000e+00, xc =   1.0000000000000000e+00; // x : left, middle, right
sr =  -4.1945818704624450e+01, si =   0.0000000000000000e+00; // Re and Im parts of eigenvalue s
ky =   6.2831853071795860e+00;   // solution is exp(i*ky*y) 
Real DL=  1.0000000000000000e+00, KL=  1.0000000000000000e+00, urtL[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtL = radial and theta velocities
Real DR=  1.0000000000000000e+00, KR=  1.0000000000000000e+00, urtR[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dx=  1.2500000000000000e-02;  // dx

Real uLvRe[]={
  -3.02655890187580e-01, -2.84309177171137e-01, -2.65852857546825e-01, -2.47294046600137e-01, -2.28639899080313e-01,
  -2.09897606524784e-01, -1.91074394459904e-01, -1.72177519565626e-01, -1.53214266961465e-01, -1.34191947351808e-01,
  -1.15117894179037e-01, -9.59994608697919e-02, -7.68440179501308e-02, -5.76589501866916e-02, -3.84516538033894e-02,
  -1.92295335844379e-02,  0.00000000000000e+00,  1.92295335844379e-02,  3.84516538033894e-02,  5.76589501866916e-02,
    7.68440179501307e-02,  9.59994608697920e-02,  1.15117894179037e-01,  1.34191947351808e-01,  1.53214266961465e-01,
    1.72177519565626e-01,  1.91074394459904e-01,  2.09897606524784e-01,  2.28639899080313e-01,  2.47294046600136e-01,
    2.65852857546825e-01,  2.84309177171136e-01,  3.02655890187580e-01,  3.20885923592736e-01,  3.38992249379311e-01,
    3.56967887187045e-01,  3.74805907084333e-01,  3.92499432177114e-01,  4.10041641251083e-01,  4.27425771481232e-01,
    4.44645120937364e-01,  4.61693051225173e-01,  4.78562990067263e-01,  4.95248433758195e-01,  5.11742949748350e-01,
    5.28040179100067e-01,  5.44133838901272e-01,  5.60017724751176e-01,  5.75685713115065e-01,  5.91131763668803e-01,
    6.06349921677329e-01,  6.21334320254748e-01,  6.36079182616289e-01,  6.50578824345997e-01,  6.64827655560554e-01,
    6.78820183052148e-01,  6.92551012440688e-01,  7.06014850236858e-01,  7.19206505864427e-01,  7.32120893690449e-01,
    7.44753034981713e-01,  7.57098059798921e-01,  7.69151208897321e-01,  7.80907835569035e-01,  7.92363407404935e-01,
    8.03513508058671e-01,  8.14353838963166e-01,  8.24880220962934e-01,  8.35088595930838e-01,  8.44975028348981e-01,
    8.54535706812488e-01,  8.63766945491580e-01,  8.72665185568542e-01,  8.81226996608575e-01,  8.89449077865784e-01,
    8.97328259568618e-01,  9.04861504149088e-01,  9.12045907395790e-01,  9.18878699580512e-01,  9.25357246535850e-01,
    9.31479050659805e-01,  9.37241751876225e-01,  9.42643128555181e-01,  9.47681098366560e-01,  9.52353719073765e-01,
    9.56659189291573e-01,  9.60595849183183e-01,  9.64162181089195e-01,  9.67356810119022e-01,  9.70178504685113e-01,
    9.72626176970029e-01,  9.74698883347944e-01,  9.76395824752100e-01,  9.77716346979993e-01,  9.78659940944057e-01,
    9.79226242870959e-01,  9.79415034441202e-01,  9.79226242871575e-01,  9.78659940944687e-01,  9.77716346981202e-01,
    9.76395824754239e-01,  9.74698883349921e-01,  9.72626176972133e-01,  9.70178504688764e-01,  9.67356810122884e-01,
    9.64162181092109e-01,  9.60595849188168e-01,  9.56659189297606e-01,  9.52353719077894e-01,  9.47681098372367e-01,
    9.42643128563159e-01,  9.37241751882003e-01,  9.31479050666159e-01
};
Real uLvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
Real uRvRe[]={
    9.31479050665855e-01,  9.37241751881724e-01,  9.42643128562781e-01,  9.47681098372244e-01,  9.52353719077600e-01,
    9.56659189297282e-01,  9.60595849188004e-01,  9.64162181091943e-01,  9.67356810122650e-01,  9.70178504688614e-01,
    9.72626176972063e-01,  9.74698883349793e-01,  9.76395824754148e-01,  9.77716346981165e-01,  9.78659940944655e-01,
    9.79226242871561e-01,  9.79415034441202e-01,  9.79226242871570e-01,  9.78659940944677e-01,  9.77716346981196e-01,
    9.76395824754190e-01,  9.74698883349847e-01,  9.72626176972125e-01,  9.70178504688688e-01,  9.67356810122734e-01,
    9.64162181092038e-01,  9.60595849188110e-01,  9.56659189297398e-01,  9.52353719077726e-01,  9.47681098372373e-01,
    9.42643128562915e-01,  9.37241751881733e-01,  9.31479050666178e-01,  9.25357246545174e-01,  9.18878699587930e-01,
    9.12045907402813e-01,  9.04861504159587e-01,  8.97328259577917e-01,  8.89449077873948e-01,  8.81226996619802e-01,
    8.72665185578905e-01,  8.63766945501774e-01,  8.54535706823996e-01,  8.44975028359610e-01,  8.35088595944169e-01,
    8.24880220974170e-01,  8.14353838973746e-01,  8.03513508075401e-01,  7.92363407415149e-01,  7.80907835580425e-01,
    7.69151208915662e-01,  7.57098059807667e-01,  7.44753034996204e-01,  7.32120893707581e-01,  7.19206505873505e-01,
    7.06014850253412e-01,  6.92551012454431e-01,  6.78820183066540e-01,  6.64827655575093e-01,  6.50578824358188e-01,
    6.36079182635653e-01,  6.21334320264964e-01,  6.06349921692294e-01,  5.91131763687432e-01,  5.75685713121667e-01,
    5.60017724771414e-01,  5.44133838915479e-01,  5.28040179106977e-01,  5.11742949769304e-01,  4.95248433766138e-01,
    4.78562990079002e-01,  4.61693051243122e-01,  4.44645120940684e-01,  4.27425771496858e-01,  4.10041641263161e-01,
    3.92499432182155e-01,  3.74805907099677e-01,  3.56967887192925e-01,  3.38992249388831e-01,  3.20885923604706e-01,
    3.02655890190489e-01,  2.84309177180733e-01,  2.65852857554823e-01,  2.47294046602560e-01,  2.28639899088347e-01,
    2.09897606529388e-01,  1.91074394462257e-01,  1.72177519570832e-01,  1.53214266962939e-01,  1.34191947352878e-01,
    1.15117894180813e-01,  9.59994608684028e-02,  7.68440179486522e-02,  5.76589501847786e-02,  3.84516537991973e-02,
    1.92295335796841e-02, -2.76301830000000e-12, -1.92295335839801e-02, -3.84516538038731e-02, -5.76589501902121e-02,
  -7.68440179531721e-02, -9.59994608742217e-02, -1.15117894185515e-01, -1.34191947358245e-01, -1.53214266970685e-01,
  -1.72177519574295e-01, -1.91074394469747e-01, -2.09897606539414e-01, -2.28639899090446e-01, -2.47294046613594e-01,
  -2.65852857566522e-01, -2.84309177182197e-01, -3.02655890205527e-01
};
Real uRvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, nth=%d\n",xa,xb,xc,sr,si,nth);
                if( rCenter >= xa && rCenter<= xb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= xb && rCenter<= xc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=xa; rb_=xb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=xa                      r=xb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, ky=%g\n",xa,xb,xc,sr,si,ky);
        }

        else if( caseName == "doubleRectangleDL0p9KL1DR0p8KR0p5" )
        {

// ---------------------------------------------------------------------------------------------------------
// doubleRectangle CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
xa =  -1.0000000000000000e+00, xb =   0.0000000000000000e+00, xc =   1.0000000000000000e+00; // x : left, middle, right
sr =  -4.1584603892661530e+01, si =   0.0000000000000000e+00; // Re and Im parts of eigenvalue s
ky =   6.2831853071795860e+00;   // solution is exp(i*ky*y) 
Real DL=  9.0000000000000000e-01, KL=  1.0000000000000000e+00, urtL[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtL = radial and theta velocities
Real DR=  8.0000000000000000e-01, KR=  5.0000000000000000e-01, urtR[]={  0.0000000000000000e+00,  0.0000000000000000e+00}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dx=  1.2500000000000000e-02;  // dx

Real uLvRe[]={
  -3.67598003850360e-01, -3.46532157766641e-01, -3.25102122159037e-01, -3.03330419019448e-01, -2.81239929416811e-01,
  -2.58853869450143e-01, -2.36195765849471e-01, -2.13289431250308e-01, -1.90158939167658e-01, -1.66828598695841e-01,
  -1.43322928960750e-01, -1.19666633351355e-01, -9.58845735575692e-02, -7.20017434417311e-02, -4.80432427711850e-02,
  -2.40342508395713e-02,  0.00000000000000e+00,  2.40342508395713e-02,  4.80432427711850e-02,  7.20017434417311e-02,
    9.58845735575693e-02,  1.19666633351355e-01,  1.43322928960749e-01,  1.66828598695841e-01,  1.90158939167658e-01,
    2.13289431250308e-01,  2.36195765849471e-01,  2.58853869450143e-01,  2.81239929416811e-01,  3.03330419019448e-01,
    3.25102122159037e-01,  3.46532157766641e-01,  3.67598003850360e-01,  3.88277521164923e-01,  4.08548976479016e-01,
    4.28391065415568e-01,  4.47782934841958e-01,  4.66704204786153e-01,  4.85134989854739e-01,  5.03055920131593e-01,
    5.20448161534769e-01,  5.37293435610256e-01,  5.53574038741802e-01,  5.69272860756553e-01,  5.84373402907096e-01,
    5.98859795211077e-01,  6.12716813129635e-01,  6.25929893567756e-01,  6.38485150179419e-01,  6.50369387961494e-01,
    6.61570117121095e-01,  6.72075566202085e-01,  6.81874694455231e-01,  6.90957203442269e-01,  6.99313547859444e-01,
    7.06934945569221e-01,  7.13813386829842e-01,  7.19941642713016e-01,  7.25313272700990e-01,  7.29922631455227e-01,
    7.33764874748647e-01,  7.36835964558350e-01,  7.39132673309117e-01,  7.40652587264866e-01,  7.41394109065128e-01,
    7.41356459403985e-01,  7.40539677849631e-01,  7.38944622802260e-01,  7.36572970592040e-01,  7.33427213717892e-01,
    7.29510658227044e-01,  7.24827420240690e-01,  7.19382421628376e-01,  7.13181384836224e-01,  7.06230826872294e-01,
    6.98538052456552e-01,  6.90111146344351e-01,  6.80958964830098e-01,  6.71091126439742e-01,  6.60518001821968e-01,
    6.49250702850225e-01,  6.37301070943246e-01,  6.24681664620298e-01,  6.11405746302920e-01,  5.97487268376822e-01,
    5.82940858528623e-01,  5.67781804372842e-01,  5.52026037385318e-01,  5.35690116159939e-01,  5.18791209006302e-01,
    5.01347075906586e-01,  4.83376049850612e-01,  4.64897017568687e-01,  4.45929399682512e-01,  4.26493130294992e-01,
    4.06608636040438e-01,  3.86296814617498e-01,  3.65579012826832e-01,  3.44477004134781e-01,  3.23012965791866e-01,
    3.01209455525261e-01,  2.79089387831680e-01,  2.56676009895296e-01,  2.33992877156024e-01,  2.11063828553823e-01,
    1.87912961475054e-01,  1.64564606427223e-01,  1.41043301468717e-01,  1.17373766420425e-01,  9.35808768863243e-02,
    6.96896381103489e-02,  4.57251586970096e-02,  2.17126242233842e-02
};
Real uLvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
Real uRvRe[]={
    8.96878704359931e-01,  8.75905659235436e-01,  8.53221819526078e-01,  8.28871490666973e-01,  8.02902233054391e-01,
    7.75364769107594e-01,  7.46312884253143e-01,  7.15803321801790e-01,  6.83895672210442e-01,  6.50652256591547e-01,
    6.16138005063841e-01,  5.80420329923322e-01,  5.43568993911410e-01,  5.05655974050253e-01,  4.66755321005453e-01,
    4.26943014421113e-01,  3.86296814617498e-01,  3.44896110612402e-01,  3.02821765099977e-01,  2.60155956550956e-01,
    2.16982018601306e-01,  1.73384277416279e-01,  1.29447886870617e-01,  8.52586623151464e-02,  4.09029129066872e-02,
  -3.53272693209351e-03, -4.79614667502569e-02, -9.22965295601929e-02, -1.36451321359482e-01, -1.80339600224569e-01,
  -2.23875644798669e-01, -2.66974421682780e-01, -3.09551751548908e-01, -3.51524473533843e-01, -3.92810607692051e-01,
  -4.33329515081748e-01, -4.73002055314253e-01, -5.11750741068795e-01, -5.49499889509197e-01, -5.86175770026415e-01,
  -6.21706748332391e-01, -6.56023426284836e-01, -6.89058777525206e-01, -7.20748278300689e-01, -7.51030033581613e-01,
  -7.79844897863223e-01, -8.07136590774655e-01, -8.32851806919460e-01, -8.56940320070726e-01, -8.79355081197574e-01,
  -9.00052310426142e-01, -9.18991582491164e-01, -9.36135905741985e-01, -9.51451794358580e-01, -9.64909333771841e-01,
  -9.76482239093826e-01, -9.86147906444668e-01, -9.93887457111372e-01, -9.99685774419976e-01, -1.00353153325795e+00,
  -1.00541722219569e+00, -1.00533915815800e+00, -1.00329749361748e+00, -9.99296216296553e-01, -9.93343141379081e-01,
  -9.85449896245718e-01, -9.75631897762714e-01, -9.63908322171624e-01, -9.50302067636224e-01, -9.34839709514004e-01,
  -9.17551448450291e-01, -8.98471051401702e-01, -8.77635785664287e-01, -8.55086346101249e-01, -8.30866775655511e-01,
  -8.05024379309813e-01, -7.77609631727257e-01, -7.48676078615566e-01, -7.18280232202832e-01, -6.86481460797122e-01,
  -6.53341872882845e-01, -6.18926195786887e-01, -5.83301649231077e-01, -5.46537814122285e-01, -5.08706496539998e-01,
  -4.69881587555169e-01, -4.30138918931355e-01, -3.89556114912369e-01, -3.48212440718392e-01, -3.06188647672319e-01,
  -2.63566815451849e-01, -2.20430191871156e-01, -1.76863030149367e-01, -1.32950424486357e-01, -8.87781437381214e-02,
  -4.44324639958657e-02,  8.37208990000000e-12,  4.44324640042363e-02,  8.87781437558382e-02,  1.32950424493629e-01,
    1.76863030167578e-01,  2.20430191881425e-01,  2.63566815469476e-01,  3.06188647685822e-01,  3.48212440735558e-01,
    3.89556114932030e-01,  4.30138918948945e-01,  4.69881587580864e-01,  5.08706496562591e-01,  5.46537814143332e-01,
    5.83301649266184e-01,  6.18926195808549e-01,  6.53341872916531e-01
};
Real uRvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, nth=%d\n",xa,xb,xc,sr,si,nth);
                if( rCenter >= xa && rCenter<= xb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= xb && rCenter<= xc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=xa; rb_=xb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=xa                      r=xb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, ky=%g\n",xa,xb,xc,sr,si,ky);
        }

        else if( caseName == "doubleRectangleDL0p9KL1UL1DR0p8KR0p5URm1" )
        {
      // DL=.9 KL= 1 UL=1
      // DR=.8 KR=.5 UR=-1
// ---------------------------------------------------------------------------------------------------------
// doubleRectangle CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
xa =  -1.0000000000000000e+00, xb =   0.0000000000000000e+00, xc =   1.0000000000000000e+00; // x : left, middle, right
sr =  -4.1680561528483560e+01, si =   0.0000000000000000e+00; // Re and Im parts of eigenvalue s
ky =   6.2831853071795860e+00;   // solution is exp(i*ky*y) 
Real DL=  9.0000000000000000e-01, KL=  1.0000000000000000e+00, urtL[]={  1.0000000000000000e+00,  0.0000000000000000e+00}; // urtL = radial and theta velocities
Real DR=  8.0000000000000000e-01, KR=  5.0000000000000000e-01, urtR[]={ -1.0000000000000000e+00,  0.0000000000000000e+00}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dx=  1.2500000000000000e-02;  // dx

Real uLvRe[]={
  -2.28378806726897e-01, -2.16754870190965e-01, -2.04735339417389e-01, -1.92327603417045e-01, -1.79539571885568e-01,
  -1.66379673982149e-01, -1.52856856532794e-01, -1.38980581651935e-01, -1.24760823776811e-01, -1.10208066109596e-01,
  -9.53332964628142e-02, -8.01480025041600e-02, -6.46641663974470e-02, -4.88942588369869e-02, -3.28512324733392e-02,
  -1.65485147289713e-02,  0.00000000000000e+00,  1.67799587401440e-02,  3.37765589659752e-02,  5.09745582299001e-02,
    6.83582843877261e-02,  8.59116464405709e-02,  1.03618145975620e-01,  1.21460889204890e-01,  1.39422599597421e-01,
    1.57485631099608e-01,  1.75631981937683e-01,  1.93843308995663e-01,  2.12100942761346e-01,  2.30385902832229e-01,
    2.48678913972518e-01,  2.66960422711676e-01,  2.85210614474231e-01,  3.03409431229874e-01,  3.21536589652153e-01,
    3.39571599773369e-01,  3.57493784122581e-01,  3.75282297332937e-01,  3.92916146203131e-01,  4.10374210197316e-01,
    4.27635262372198e-01,  4.44677990708289e-01,  4.61481019831708e-01,  4.78022933107957e-01,  4.94282295089026e-01,
    5.10237674294673e-01,  5.25867666308040e-01,  5.41150917165182e-01,  5.56066147017491e-01,  5.70592174045364e-01,
    5.84707938600945e-01,  5.98392527557189e-01,  6.11625198839942e-01,  6.24385406119247e-01,  6.36652823635543e-01,
    6.48407371135720e-01,  6.59629238892742e-01,  6.70298912787925e-01,  6.80397199423512e-01,  6.89905251242013e-01,
    6.98804591625319e-01,  7.07077139946043e-01,  7.14705236542877e-01,  7.21671667595033e-01,  7.27959689862928e-01,
    7.33553055269092e-01,  7.38436035291131e-01,  7.42593445137192e-01,  7.46010667675026e-01,  7.48673677085395e-01,
    7.50569062210174e-01,  7.51684049568593e-01,  7.52006526005346e-01,  7.51525060949600e-01,  7.50228928250026e-01,
    7.48108127557753e-01,  7.45153405228189e-01,  7.41356274712187e-01,  7.36709036408734e-01,  7.31204796946710e-01,
    7.24837487872476e-01,  7.17601883712012e-01,  7.09493619378063e-01,  7.00509206895817e-01,  6.90646051419611e-01,
    6.79902466513507e-01,  6.68277688669052e-01,  6.55771891034240e-01,  6.42386196326898e-01,  6.28122688907771e-01,
    6.12984425990184e-01,  5.96975447959288e-01,  5.80100787778690e-01,  5.62366479461595e-01,  5.43779565584287e-01,
    5.24348103820452e-01,  5.04081172475640e-01,  4.82988875001932e-01,  4.61082343473629e-01,  4.38373741005582e-01,
    4.14876263097325e-01,  3.90604137885780e-01,  3.65572625291354e-01,  3.39798015042876e-01,  3.13297623567837e-01,
    2.86089789735389e-01,  2.58193869440632e-01,  2.29630229019809e-01,  2.00420237487128e-01,  1.70586257585074e-01,
    1.40151635641065e-01,  1.09140690224969e-01,  7.75786996033604e-02
};
Real uLvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
Real uRvRe[]={
    1.42670269040396e+00,  1.37919104442253e+00,  1.32971749758572e+00,  1.27840926540260e+00,  1.22539518084020e+00,
    1.17080541705084e+00,  1.11477121209613e+00,  1.05742459543194e+00,  9.98898117532309e-01,  9.39324582283662e-01,
    8.78836783336462e-01,  8.17567244390824e-01,  7.55647964073357e-01,  6.93210165877439e-01,  6.30384053335460e-01,
    5.67298571180635e-01,  5.04081172475640e-01,  4.40857592444111e-01,  3.77751629061099e-01,  3.14884930834032e-01,
    2.52376792185056e-01,  1.90343956448976e-01,  1.28900427104504e-01,  6.81572870975017e-02,  8.22252685779245e-03,
  -5.07991191006426e-02, -1.08806326604390e-01, -1.65701327184598e-01, -2.21390044279790e-01, -2.75782220013512e-01,
  -3.28791532650380e-01, -3.80335704401480e-01, -4.30336599777468e-01, -4.78720314184950e-01, -5.25417252988783e-01,
  -5.70362200811298e-01, -6.13494381278923e-01, -6.54757507080719e-01, -6.94099820531962e-01, -7.31474124593250e-01,
  -7.66837804527231e-01, -8.00152840223152e-01, -8.31385809361384e-01, -8.60507881519233e-01, -8.87494803395299e-01,
  -9.12326875292090e-01, -9.34988919076128e-01, -9.55470237760589e-01, -9.73764566970565e-01, -9.89870018480710e-01,
  -1.00378901604858e+00, -1.01552822384031e+00, -1.02509846764244e+00, -1.03251464915063e+00, -1.03779565363777e+00,
  -1.04096425123895e+00, -1.04204699216526e+00, -1.04107409615252e+00, -1.03807933644838e+00, -1.03309991863943e+00,
  -1.02617635464267e+00, -1.01735233215968e+00, -1.00667458001164e+00, -9.94192729491553e-01, -9.79959172344970e-01,
  -9.64028915357650e-01, -9.46459432310574e-01, -9.27310513180875e-01, -9.06644111262779e-01, -8.84524188488580e-01,
  -8.61016559060682e-01, -8.36188731955773e-01, -8.10109752648346e-01, -7.82850044132388e-01, -7.54481247745796e-01,
  -7.25076064206717e-01, -6.94708094875672e-01, -6.63451683759321e-01, -6.31381760636906e-01, -5.98573685281467e-01,
  -5.65103093353298e-01, -5.31045744219926e-01, -4.96477370685069e-01, -4.61473531321425e-01, -4.26109465297151e-01,
  -3.90459950090942e-01, -3.54599162415655e-01, -3.18600542298461e-01, -2.82536660919207e-01, -2.46479091983649e-01,
  -2.10498287246572e-01, -1.74663455970465e-01, -1.39042448859242e-01, -1.03701646285880e-01, -6.87058512855176e-02,
  -3.41181871426043e-02, -9.15366300000000e-13,  3.35892336858707e-02,  6.65919944679079e-02,  9.89528021640018e-02,
    1.30618292745295e-01,  1.61537289971216e-01,  1.91660871593905e-01,  2.20942430116467e-01,  2.49337728131594e-01,
    2.76804948090003e-01,  3.03304736643304e-01,  3.28800243404022e-01,  3.53257154268305e-01,  3.76643719213437e-01,
    3.98930774680067e-01,  4.20091760525672e-01,  4.40102731633636e-01
};
Real uRvIm[]={
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00,
    0.00000000000000e+00,  0.00000000000000e+00,  0.00000000000000e+00
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, nth=%d\n",xa,xb,xc,sr,si,nth);
                if( rCenter >= xa && rCenter<= xb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= xb && rCenter<= xc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=xa; rb_=xb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=xa                      r=xb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, ky=%g\n",xa,xb,xc,sr,si,ky);
        }    

        else if( caseName == "doubleRectangleDL0p9KL1UL1VL0p5DR0p8KR0p5URm1VR1" )
        {
      // DL=.9 KL= 1 UL=1   VL=.5
      // DR=.8 KR=.5 UR=-1  VR=1
// ---------------------------------------------------------------------------------------------------------
// doubleRectangle CHT exact numerical solution (computed with doubleAnnulus.mw).
// ---------------------------------------------------------------------------------------------------------
xa =  -1.0000000000000000e+00, xb =   0.0000000000000000e+00, xc =   1.0000000000000000e+00; // x : left, middle, right
sr =  -4.1476298208725780e+01, si =  -4.7713897046243868e+00; // Re and Im parts of eigenvalue s
ky =   6.2831853071795865e+00;   // solution is exp(i*ky*y) 
Real DL=  9.0000000000000000e-01, KL=  1.0000000000000000e+00, urtL[]={  1.0000000000000000e+00,  5.0000000000000000e-01}; // urtL = radial and theta velocities
Real DR=  8.0000000000000000e-01, KR=  5.0000000000000000e-01, urtR[]={ -1.0000000000000000e+00,  1.0000000000000000e+00}; // urtR = radial and theta velocities
// Grid:   ia-numGhost, ... ia+numGhost
const int N=80, Ng=113;  // N=num points, Ng = total number of points in array
const int ia=0, ib=80; // ia,ib - index of left and right boundaries
const int numGhost=16;  // number of ghost points on left and right
const Real dx=  1.2500000000000000e-02;  // dx

Real uLvRe[]={
  -2.28720437394377e-01, -2.17040254410758e-01, -2.04970465417720e-01, -1.92518285523015e-01, -1.79691413786855e-01,
  -1.66498032688531e-01, -1.52946807137555e-01, -1.39046883023304e-01, -1.24807885297434e-01, -1.10239915583616e-01,
  -9.53535493094708e-02, -8.01598323558904e-02, -6.46702772192655e-02, -4.88968586824768e-02, -3.28520089908526e-02,
  -1.65486125296520e-02,  0.00000000000000e+00,  1.67800579094271e-02,  3.37773573572834e-02,  5.09772686929286e-02,
    6.83647443098214e-02,  8.59243270100482e-02,  1.03640158880686e-01,  1.21495990682273e-01,  1.39475191749229e-01,
    1.57560760401621e-01,  1.75735334867223e-01,  1.93981204712375e-01,  2.12280322779650e-01,  2.30614317629906e-01,
    2.48964506485790e-01,  2.67311908673308e-01,  2.85637259557538e-01,  3.03921024968130e-01,  3.22143416109664e-01,
    3.40284404951499e-01,  3.58323740091160e-01,  3.76240963084865e-01,  3.94015425238211e-01,  4.11626304849541e-01,
    4.29052624897987e-01,  4.46273271167620e-01,  4.63267010798633e-01,  4.80012511255929e-01,  4.96488359704924e-01,
    5.12673082783872e-01,  5.28545166761424e-01,  5.44083078067621e-01,  5.59265284185957e-01,  5.74070274893587e-01,
    5.88476583836246e-01,  6.02462810423830e-01,  6.16007642032123e-01,  6.29089876495531e-01,  6.41688444875193e-01,
    6.53782434486280e-01,  6.65351112167745e-01,  6.76373947777266e-01,  6.86830637893594e-01,  6.96701129707980e-01,
    7.05965645085844e-01,  7.14604704779339e-01,  7.22599152770941e-01,  7.29930180727708e-01,  7.36579352545356e-01,
    7.42528628960806e-01,  7.47760392211395e-01,  7.52257470718467e-01,  7.56003163772608e-01,  7.58981266197343e-01,
    7.61176092967693e-01,  7.62572503759531e-01,  7.63155927405325e-01,  7.62912386231412e-01,  7.61828520251585e-01,
    7.59891611191419e-01,  7.57089606317405e-01,  7.53411142044606e-01,  7.48845567296285e-01,  7.43382966588595e-01,
    7.37014182813184e-01,  7.29730839690294e-01,  7.21525363864683e-01,  7.12391006616491e-01,  7.02321865158963e-01,
    6.91312903494761e-01,  6.79359972802467e-01,  6.66459831324692e-01,  6.52610163729173e-01,  6.37809599914080e-01,
    6.22057733228749e-01,  6.05355138081014e-01,  5.87703386902273e-01,  5.69105066441495e-01,  5.49563793359374e-01,
    5.29084229093961e-01,  5.07672093969152e-01,  4.85334180517616e-01,  4.62078365989847e-01,  4.37913624021263e-01,
    4.12850035429482e-01,  3.86898798114182e-01,  3.60072236032212e-01,  3.32383807220986e-01,  3.03848110843516e-01,
    2.74480893228849e-01,  2.44299052882089e-01,  2.13320644438656e-01,  1.81564881537913e-01,  1.49052138591829e-01,
    1.15803951424930e-01,  8.18430167623398e-02,  4.71931905434187e-02
};
Real uLvIm[]={
    2.80886511733081e-03,  2.33773416800335e-03,  1.91941387170128e-03,  1.55163922108388e-03,  1.23195206169128e-03,
    9.57703138820248e-04,  7.26054509363894e-04,  5.33982320931365e-04,  3.78279960082347e-04,  2.55561571020421e-04,
    1.62265945588262e-04,  9.46607848974770e-05,  4.88473324067882e-05,  2.07653777348136e-05,  6.19862995845958e-06,
    7.80458605413176e-07,  0.00000000000000e+00, -7.91373933692790e-07, -6.37322786837107e-06, -2.16488802925334e-05,
  -5.16378703447459e-05, -1.01468079429701e-04, -1.76367513359275e-04, -2.81655751340752e-04, -4.22735068714939e-04,
  -6.05081240928413e-04, -8.34234036805809e-04, -1.11578740976903e-03, -1.45537939623030e-03, -1.85868173096358e-03,
  -2.33138918983387e-03, -2.87920867083543e-03, -3.50784802495687e-03, -4.22300464895283e-03, -5.03035385265835e-03,
  -5.93553701403059e-03, -6.94414953564471e-03, -8.06172861690367e-03, -9.29374085674586e-03, -1.06455697021484e-02,
  -1.21225027582277e-02, -1.37297189762286e-02, -1.54722757361758e-02, -1.73550958414229e-02, -1.93829544427890e-02,
  -2.15604659104087e-02, -2.38920706718401e-02, -2.63820220353839e-02, -2.90343730179482e-02, -3.18529631971665e-02,
  -3.48414056078241e-02, -3.80030737029780e-02, -4.13410884004639e-02, -4.48583052357742e-02, -4.85573016425541e-02,
  -5.24403643822069e-02, -5.65094771443197e-02, -6.07663083398139e-02, -6.52121991088986e-02, -6.98481515660443e-02,
  -7.46748173043194e-02, -7.96924861815155e-02, -8.49010754105594e-02, -9.03001189767383e-02, -9.58887574042764e-02,
  -1.01665727894777e-01, -1.07629354859990e-01, -1.13777540871291e-01, -1.20107758048126e-01, -1.26617039907559e-01,
  -1.33301973696860e-01, -1.40158693230867e-01, -1.47182872255634e-01, -1.54369718359576e-01, -1.61713967453037e-01,
  -1.69209878836860e-01, -1.76851230880164e-01, -1.84631317327131e-01, -1.92542944252164e-01, -2.00578427682300e-01,
  -2.08729591905263e-01, -2.16987768480991e-01, -2.25343795973901e-01, -2.33788020422540e-01, -2.42310296562645e-01,
  -2.50899989818928e-01, -2.59545979080220e-01, -2.68236660271850e-01, -2.76959950738360e-01, -2.85703294448851e-01,
  -2.94453668036414e-01, -3.03197587682221e-01, -3.11921116853949e-01, -3.20609874907286e-01, -3.29249046558275e-01,
  -3.37823392233288e-01, -3.46317259302372e-01, -3.54714594200666e-01, -3.62998955441517e-01, -3.71153527523788e-01,
  -3.79161135734744e-01, -3.87004261848727e-01, -3.94665060720658e-01, -4.02125377772181e-01, -4.09366767367054e-01,
  -4.16370512071126e-01, -4.23117642790975e-01, -4.29588959784001e-01, -4.35765054531432e-01, -4.41626332464415e-01,
  -4.47153036532000e-01, -4.52325271598472e-01, -4.57123029656132e-01
};
Real uRvRe[]={
    1.48884975002418e+00,  1.43683859413769e+00,  1.38294075698409e+00,  1.32729362683925e+00,  1.27003549517377e+00,
    1.21130527866476e+00,  1.15124224505141e+00,  1.08998574327346e+00,  1.02767493831579e+00,  9.64448551165661e-01,
    9.00444604272524e-01,  8.35800172882836e-01,  7.70651142604752e-01,  7.05131973539601e-01,  6.39375471298818e-01,
    5.73512565206507e-01,  5.07672093969152e-01,  4.41980599075151e-01,  3.76562126167841e-01,  3.11538034616661e-01,
    2.47026815491948e-01,  1.83143918129731e-01,  1.20001585453768e-01,  5.77086982029818e-02, -3.62937180654660e-03,
  -6.39108992747222e-02, -1.23037933774189e-01, -1.80916418797685e-01, -2.37456301441363e-01, -2.92571632687541e-01,
  -3.46180658268212e-01, -3.98205900108176e-01, -4.48574228363928e-01, -4.97216924091307e-01, -5.44069732591461e-01,
  -5.89072907500809e-01, -6.32171245706435e-01, -6.73314113183624e-01, -7.12455461867120e-01, -7.49553837682056e-01,
  -7.84572379874396e-01, -8.17478811794147e-01, -8.48245423297432e-01, -8.76849044945902e-01, -9.03271014193742e-01,
  -9.27497133763787e-01, -9.49517622424946e-01, -9.69327058393237e-01, -9.86924315588291e-01, -1.00231249298610e+00,
  -1.01549883731717e+00, -1.02649465936695e+00, -1.03531524414263e+00, -1.04197975517695e+00, -1.04651113324548e+00,
  -1.04893598977946e+00, -1.04928449526077e+00, -1.04759026288992e+00, -1.04389022782139e+00, -1.03822452226382e+00,
  -1.03063634674469e+00, -1.02117183784107e+00, -1.00987993267928e+00, -9.96812230506880e-01, -9.82022851640586e-01,
  -9.65568294093259e-01, -9.47507288182130e-01, -9.27900649418958e-01, -9.06811129980814e-01, -8.84303269057647e-01,
  -8.60443242369839e-01, -8.35298711145469e-01, -8.08938670843085e-01, -7.81433299901423e-01, -7.52853808792714e-01,
  -7.23272289651022e-01, -6.92761566741430e-01, -6.61395048029946e-01, -6.29246578107615e-01, -5.96390292715663e-01,
  -5.62900475111476e-01, -5.28851414507882e-01, -4.94317266810593e-01, -4.59371917870781e-01, -4.24088849461604e-01,
  -3.88541008179133e-01, -3.52800677459523e-01, -3.16939352895487e-01, -2.81027621026150e-01, -2.45135041765236e-01,
  -2.09330034623254e-01, -1.73679768869962e-01, -1.38250057773878e-01, -1.03105257046020e-01, -6.83081676054026e-02,
  -3.39199427741047e-02,  3.24485300000000e-19,  3.33940628045335e-02,  6.62065462293366e-02,  9.83837235697792e-02,
    1.29873910207499e-01,  1.60627528119049e-01,  1.90597165472514e-01,  2.19737631281623e-01,  2.48006005096295e-01,
    2.75361681717802e-01,  3.01766410935896e-01,  3.27184332294237e-01,  3.51582004899294e-01,  3.74928432296583e-01,
    3.97195082446590e-01,  4.18355902841014e-01,  4.38387330808084e-01
};
Real uRvIm[]={
  -1.92121708893618e-01, -2.09655992328150e-01, -2.26095691608631e-01, -2.41442047284577e-01, -2.55698888969876e-01,
  -2.68872547358361e-01, -2.80971762625722e-01, -2.92007589529679e-01, -3.01993299520565e-01, -3.10944280173981e-01,
  -3.18877932255999e-01, -3.25813564729481e-01, -3.31772288007565e-01, -3.36776905757094e-01, -3.40851805551010e-01,
  -3.44022848664207e-01, -3.46317259302372e-01, -3.47763513547713e-01, -3.48391228299377e-01, -3.48231050479709e-01,
  -3.47314546770405e-01, -3.45674094135025e-01, -3.43342771376356e-01, -3.40354251968676e-01, -3.36742698396247e-01,
  -3.32542658220187e-01, -3.27788962086495e-01, -3.22516623878225e-01, -3.16760743204858e-01, -3.10556410411678e-01,
  -3.03938614281574e-01, -2.96942152591049e-01, -2.89601545671528e-01, -2.81950953116158e-01, -2.74024093761373e-01,
  -2.65854169061474e-01, -2.57473789963420e-01, -2.48914907377974e-01, -2.40208746332308e-01, -2.31385743878159e-01,
  -2.22475490818693e-01, -2.13506677306398e-01, -2.04507042353563e-01, -1.95503327286340e-01, -1.86521233162909e-01,
  -1.77585382166018e-01, -1.68719282970101e-01, -1.59945300073336e-01, -1.51284627075370e-01, -1.42757263872120e-01,
  -1.34381997729923e-01, -1.26176388192556e-01, -1.18156755766096e-01, -1.10338174318463e-01, -1.02734467122561e-01,
  -9.53582064644833e-02, -8.82207167310202e-02, -8.13320808839338e-02, -7.47011502220064e-02, -6.83355573258062e-02,
  -6.22417320744312e-02, -5.64249206181952e-02, -5.08892071863180e-02, -4.56375386041758e-02, -4.06717513905610e-02,
  -3.59926013016937e-02, -3.15997951854234e-02, -2.74920250061582e-02, -2.36670038985536e-02, -2.01215041058911e-02,
  -1.68513966573687e-02, -1.38516926372064e-02, -1.11165858975448e-02, -8.63949706656182e-03, -6.41311870306686e-03,
  -4.42946144902444e-03, -2.67990103201947e-03, -1.15522597058794e-03,  1.54314163409081e-04,  1.25896006959986e-03,
    2.16939377342329e-03,  2.89668955004849e-03,  3.45226485545469e-03,  3.84783139941420e-03,  4.09534649202344e-03,
    4.20696479206362e-03,  4.19499058185758e-03,  4.07183068943396e-03,  3.84994817472988e-03,  3.54181689227172e-03,
    3.15987703828434e-03,  2.71649178550714e-03,  2.22390510415514e-03,  1.69420086246889e-03,  1.13926329516424e-03,
    5.70738922835615e-04, -3.89123870000000e-19, -5.61890435991966e-04, -1.10421184849222e-03, -1.61661775645856e-03,
  -2.08916550530090e-03, -2.51234420393785e-03, -2.87710078404474e-03, -3.17486414319489e-03, -3.39756733931034e-03,
  -3.53766780953334e-03, -3.58816559229053e-03, -3.54261953693727e-03, -3.39516149092539e-03, -3.14050845992234e-03,
  -2.77397274171124e-03, -2.29147004000801e-03, -1.68952556953229e-03
};
                printF("AdExactSolutions: GET DATA FOR EXACT SOLUTION:\n  Ng=%d, ia=%d, ib=%d\n",Ng,ia,ib);
        // printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, nth=%d\n",xa,xb,xc,sr,si,nth);
                if( rCenter >= xa && rCenter<= xb )
                {
                    domain=0; // inner domain 
                }
                else if( rCenter >= xb && rCenter<= xc )
                {
                    domain=1; // outer domain
                }
                else
                {
                    printF("AdExactSolutions:initialize:ERROR: rCenter=%g is not in one of thre domains!\n",rCenter);
                    OV_ABORT("error");
                }
                printF("  rCenter=%g --> setting domain=%d (0=inner, 1=outer)\n",rCenter,domain);
        // Fill in variables with the "same" name but in outer-scope 
        // ra_=xa; rb_=xb; sr_=sr; si_=si; nth_=nth; // assign variables in the outer scope
        // Grid in r (includes ghost)
        //         +--+--X--+--+--+-- ...   --+--+--X--+--+
        //         1     ia                         ib    Ng
        //               r=xa                      r=xb
        //               0  1  2                    nr         <- base 0 
                int nr = ib-ia+1;          // number of grid points
        // int numGhost0 = ia-1;      // num ghost on left 
        // int numGhost1 = Ng-ib;     // num ghost on right
        // assert( numGhost0==numGhost1 ); 
                int numGhost0 = numGhost;
                int numGhost1 = numGhost;
                IntegerArray dimension(2,3), gridIndexRange(2,3);
                dimension=0;
                gridIndexRange=0;
                gridIndexRange(1,0)=nr-1;
                dimension(0,0)=gridIndexRange(0,0)-numGhost0;
                dimension(1,0)=gridIndexRange(1,0)+numGhost1;
                int nurbsDegree=3; // **** WHAT SHOULD THIS BE *****
                int xDegree[3] ={ nurbsDegree,nurbsDegree,nurbsDegree };  // 
                int domainDimension=1, rangeDimension=2; 
                RealArray x(Range(dimension(0,0),dimension(1,0)),1,1,1,rangeDimension);  // data 
        // RealArray x(Ng,1,1,1,rangeDimension);  // data 
        // Real *uReArray[]={ uLvRe, uRvRe }; // array of pointers to array of real-parts 
        // Real *uImArray[]={ uLvIm, uRvIm }; // array of pointers to array of imaginary-parts 
                Real *uRe = domain==0 ? uLvRe : uRvRe;
                Real *uIm = domain==0 ? uLvIm : uRvIm;
                const int offset = dimension(0,0); 
                for( int i=dimension(0,0); i<=dimension(1,0); i++ )
                {
          // printF(" domain=%d: i=%4d i-offset=%4d, uRe=%g, uIm=%g\n",domain,i,i-offset,uRe[i-offset],uIm[i-offset]);
                    x(i,0,0,0,0) = uRe[i-offset];
                    x(i,0,0,0,1) = uIm[i-offset]; 
                }
        // --- Nurbs[n] holds the Re and Im parts of the solution ---
                int n=0;
                nurbs[n].interpolate( x,domainDimension,rangeDimension,dimension,gridIndexRange,
                                                            NurbsMapping::parameterizeByIndex,xDegree );
                if( 1==0 )
                {
                    RealArray rv(1,1), wv(1,3);
                    rv=0.;
                    rv(0,0)=0.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));
                    rv(0,0)=1.;
                    nurbs[n].map(rv,wv);
                    printF("r=%g, wv=[%g,%g]\n",rv(0,0),wv(0,0),wv(0,1));    
                }
            printF("  xa=%g, xb=%g, xc=%g, sr=%g, si=%g, ky=%g\n",xa,xb,xc,sr,si,ky);
        }  

        else
        {
            printF("AdExactSolutions:initialize:ERROR: unknown caseName=[%s]\n",(const char*)caseName);
            OV_ABORT("ERROR");
        }

        Real a,b;  // local values for inner and outer radii
        if( domain==0 )
        {
            a=xa; b=xb;  // left rectangle
        }
        else
        {
            a=xb; b=xc; // right rectangle
        }

    // ---- Fill in Grid functions with the Real and Imaginary Parts of the Spatial Eigenfunction ----

        realCompositeGridFunction & wRe = dbase.put<realCompositeGridFunction>("wRe");
        realCompositeGridFunction & wIm = dbase.put<realCompositeGridFunction>("wIm");

        const int numberOfDimensions = cg.numberOfDimensions();

        const int numberOfComponents = 1; // 
        Range all;
        wRe.updateToMatchGrid(cg,all,all,all,numberOfComponents);
        wIm.updateToMatchGrid(cg,all,all,all,numberOfComponents);

        std::complex<LocalReal> I(0,1.); 
        std::complex<LocalReal> u, expi; 

        RealArray rv(1,1), wv(1,3);
        rv=0.;

        Index I1,I2,I3;
        for( int grid=0; grid<cg.numberOfComponentGrids(); grid++ )
        {
            MappedGrid & mg = cg[grid];
            mg.update(MappedGrid::THEvertex | MappedGrid::THEcenter);
            getIndex( mg.dimension(),I1,I2,I3 );

            OV_GET_SERIAL_ARRAY(real,mg.center(),xLocal);
            OV_GET_SERIAL_ARRAY(real,wRe[grid],wReLocal);
            OV_GET_SERIAL_ARRAY(real,wIm[grid],wImLocal);

            int i1,i2,i3;
            FOR_3D(i1,i2,i3,I1,I2,I3)
            {
                Real x = xLocal(i1,i2,i3,0);
                Real y = xLocal(i1,i2,i3,1);

                rv(0,0) = (x-a)/(b-a); // scale r to [0,1]

                nurbs[0].map( rv,wv );  // eval Real and Im parts of u
                u = ( wv(0,0) + I*wv(0,1) ) ;

        // --- form the spatial part (complex) of the solution ---
        //   uHat(x)*exp( i*ky*y )
                expi = cos( ky*y ) + I*sin( ky*y );

                u = u*expi;  // complex solution (without time dependence ß)

                wReLocal(i1,i2,i3,0) = std::real( u );
                wImLocal(i1,i2,i3,0) = std::imag( u );


            }

        } // end for grid 


    // const Real kypi = twoPi*ky; 

    // Index I1,I2,I3;
    // for( int grid=0; grid<cg.numberOfComponentGrids(); grid++ )
    // {
    //   MappedGrid & mg = cg[grid];
    //   mg.update(MappedGrid::THEvertex | MappedGrid::THEcenter);
    //   getIndex( mg.dimension(),I1,I2,I3 );

    //   OV_GET_SERIAL_ARRAY(real,mg.center(),xLocal);
    //   OV_GET_SERIAL_ARRAY(real,wRe[grid],wReLocal);
    //   OV_GET_SERIAL_ARRAY(real,wIm[grid],wImLocal);

    //   int i1,i2,i3;
    //   FOR_3D(i1,i2,i3,I1,I2,I3)
    //   {
    //     Real x = xLocal(i1,i2,i3,0);
    //     Real y = xLocal(i1,i2,i3,1);

    //     u = ( aPlus*exp( rPlus*x ) + aMinus*exp( rMinus*x ) )*exp( I*kypi*y ); 

    //     wReLocal(i1,i2,i3,0) = std::real( u );
    //     wImLocal(i1,i2,i3,0) = std::imag( u );
    //   }
    // } // end for grid 

    }
    else
    {
        printF("AdExactSolutions:initialize:ERROR: unknown exactSolution=[%s]\n",(const char*)exactSolution);
        OV_ABORT("ERROR");

    }
    return 0;
}




//========================================================================================================
/// \brief Evaluate the exact solution
//========================================================================================================
int AdExactSolutions::
evalSolution(Real t, CompositeGrid & cg, int grid, RealArray & ua, 
                          const Index & I1, const Index &I2, const Index &I3, 
                          int numberOfTimeDerivatives /* = 0 */  )
{

    const aString & exactSolution = dbase.get<aString>("exactSolution");

    const bool & initialized=dbase.get<bool>("initialized");
    if( !initialized )
    {
        OV_ABORT("AdExactSolutions:ERROR:evalSolution: Solution is NOT initialized!");
    }


    MappedGrid & mg = cg[grid];

    OV_GET_SERIAL_ARRAY(real,ua,uLocal);

  // -- Here are the real and imaginary parts of the spatial solution ---
    realCompositeGridFunction & wRe = dbase.get<realCompositeGridFunction>("wRe");
    realCompositeGridFunction & wIm = dbase.get<realCompositeGridFunction>("wIm");
    OV_GET_SERIAL_ARRAY(real,wRe[grid],wReLocal);
    OV_GET_SERIAL_ARRAY(real,wIm[grid],wImLocal);

    const Real & sr = dbase.get<Real>("sr"); 
    const Real & si = dbase.get<Real>("si"); 
    Real omega = si; 
    Real amp = exp(sr*t);
    Real coswt, sinwt;
    if( numberOfTimeDerivatives==0 )
    {
        coswt = cos(omega*t);  
        sinwt = sin(omega*t);
    }
    else if( numberOfTimeDerivatives==1 )
    {
        coswt = -omega*sin(omega*t); 
        sinwt =  omega*cos(omega*t);
    }
    else
    {
        OV_ABORT("error");
    }
    printF("AdExactSolutions:evalSolution: sr=%g, si=%g, coswt=%g, sinwt=%g, amp=%g, t=%g\n",sr,si,coswt,sinwt,amp,t);
    int i1,i2,i3;
    FOR_3D(i1,i2,i3,I1,I2,I3)
    {
    // solution = Re( (wRe+I*wIm)*exp( sr*t + I*si*t )
    //          = Re( exp(sr*t)*( wRe + I*wIm )*( cos(si*t) + I*sin(si*t) )  )
    //          = exp(sr*t)*( wRe*cos(si*t) - wIm*sin(si*t) )
        uLocal(i1,i2,i3,0) = amp*(wReLocal(i1,i2,i3,0)*coswt - wImLocal(i1,i2,i3,0)*sinwt);   // *wdh* changed sign May 12, 2022

    }

    return 0;
}


